from twitter_profiling.community.community import Community
from tweet_utility import get_users_tweet
import numpy as np
from twitter_profiling.profiling_operators.intersection import minus_k_intersection_linear


collection = 'tweets'
db_name = 'twitter'
port = 27017
percentage = 0.7

def get_internal_mentions(com):
    # type: (Community)->float
    mentions_grouped_by_user = get_users_tweet(com.users)

    cont = 0

    for user in mentions_grouped_by_user:
        u_in_mentions = []
        # print user
        for m in user['mentions']:
            # print m
            if m in com.users:
                cont = cont +1
    print '# internal mentions',cont
    print 'index of internal mentions :', cont/float(len(com.users) ), 'per user'
    return cont

def get_out_mentions(com):
    # type: (Community)->float
    mentions_grouped_by_user = get_users_tweet(com.users)

    cont = 0

    for user in mentions_grouped_by_user:
        u_in_mentions = []
        # print user
        for m in user['mentions']:
            # print m
            if not m in com.users:
                cont = cont + 1
    print '# outside mentions', cont
    print 'index of out mentions :', cont / float(len(com.users)), 'per user'
    return cont

def get_common_mentions(com):
    mentions_grouped_by_user = get_users_tweet(com.users)
    mentions = map(lambda doc: set(doc.get('mentions_names') ), mentions_grouped_by_user)
    n_users = len(com.users)
    k = int(n_users * percentage)

    common_mentions = minus_k_intersection_linear(mentions, k = k)
    print 'common_mentions', len(common_mentions), common_mentions
    return common_mentions

def get_common_hashtag(com):
    hashtags_grouped_by_user = get_users_tweet(com.users)
    hashtags = map(lambda doc: set(doc.get('hashtags')), hashtags_grouped_by_user)
    n_users = len(com.users)
    k = int(n_users * percentage)

    common_hashtags = minus_k_intersection_linear(hashtags, k=k)
    print 'common_hashtag', len(common_hashtags), common_hashtags
    return common_hashtags

users2 = [ "291364824", "920675346", "190052199", "332854373", "1716578040", "19280100", "207371354", "380288248", "408815596", "164786871", "370754131", "1116416330", "1160926956", "825906386", "182428433", "303901306", "200461314", "392487826", "19854139", "287229783", "111940614", "24560295", "205622300", "1572692082", "266196019", "962728567", "185977834", "63525184", "382560919", "1431953737", "382809645", "583783147", "604768692", "1639897656", "1255028623", "798701498", "568248162", "162779090", "20299922", "130893258", "178418353", "23440052", "248254612", "1143472657", "22655140", "471391075", "70945714", "557235026", "355559587", "255677704", "507460995", "298173961", "1432840862", "121161592", "115095199", "216343274", "159882006", "94811283", "47568495", "1210159567", "222535902", "74958016", "1464619771", "1268612959", "26616324", "572684914", "150746307", "294200866", "26121908", "293645994", "290428813", "1890409812", "229284088", "21710527", "196758914", "317832296", "28524993", "20236332", "1417537674", "579304507", "298537212", "1583589793", "175124549", "379170182", "77047730", "902795966", "303074762", "22634364", "313522264", "563153314", "363111719", "432794829", "127340684", "44641971", "456739709" ]
users7=[ "365340354", "152978469", "107167985", "1432840862", "91361852", "24560295", "63525184", "864381716", "439372416", "68674747", "216322133", "298537212", "124218221", "1160926956", "568248162", "228291020", "77047730", "23440052", "248254612", "22655140", "392487826", "106828762", "293127661", "471391075", "363111719", "127340684", "21710527", "456739709" ]
users_huge = [ "291364824", "710768366", "1716578040", "397416401", "19280100", "175124549", "216322133", "67838407", "408815596", "30334602", "164786871", "213394037", "1431969966", "191338047", "20600235", "1143472657", "244495300", "303901306", "250640838", "392487826", "20232903", "532515257", "150622494", "287229783", "266176905", "515382047", "24560295", "259270050", "962728567", "63525184", "41918985", "1555220952", "1431953737", "1183238071", "462346627", "583783147", "33192889", "1639897656", "764467154", "146015368", "280606089", "64449028", "794246348", "207371354", "130893258", "301521704", "178418353", "23440052", "1464619771", "123473893", "244405901", "471391075", "70945714", "575725973", "420310681", "71370894", "21392589", "872613656", "295182164", "499008656", "115095199", "159882006", "55801527", "222535902", "124218221", "425743064", "1262466824", "468412736", "105106802", "218482045", "205622300", "591410868", "447035052", "224752274", "226401184", "28961325", "177612773", "181496896", "264787053", "1652688720", "21105599", "379170182", "169026405", "100341842", "11869952", "24208857", "40110834", "30877971", "127340684", "248745292", "211809879", "456739709", "920675346", "379250311", "372679041", "78085057", "344584770", "21503564", "280119513", "243775994", "286845136", "72496791", "22903129", "554724537", "21870376", "55541412", "38837649", "67606740", "183368624", "1588480435", "27264916", "91361852", "332961319", "234711040", "322825184", "406544435", "19541973", "382560919", "572065285", "516192622", "68367000", "21200516", "228291020", "1390516934", "230904991", "248254612", "1297483208", "28524993", "499108538", "557235026", "93945790", "121161592", "53053378", "397350140", "241985570", "94811283", "1683420414", "219947303", "1210159567", "412382937", "23575595", "22472942", "210240661", "1369949750", "293645994", "67613844", "390302704", "290428813", "710452999", "1405782721", "56652148", "229284088", "21710527", "45673545", "216372101", "563153314", "1431547597", "247292448", "1142458086", "486720661", "724364101", "864381716", "528354628", "293056620", "19854139", "101188210", "55259613", "248275383", "1274563628", "319790802", "839939544", "836490241", "77047730", "470336591", "68388067", "29337915", "281337902", "313522264", "504143250", "468568388", "93174049", "26483124", "190052199", "332854373", "271516560", "276402523", "279960370", "235255525", "385484469", "437739680", "1142534180", "1160926956", "556260847", "604768692", "41790207", "48737130", "295187623", "410648049", "169498575", "380288248", "1162939650", "1330155565", "579304507", "121188779", "1572692082", "266196019", "43181541", "531301042", "483267059", "497144979", "25889930", "1499913876", "16359415", "568248162", "162779090", "78664302", "266772279", "451049246", "587784388", "1432840862", "199761419", "80324287", "47568495", "26616324", "294200866", "194229818", "539439796", "586076295", "111940614", "238377952", "1699914018", "152978469", "21227532", "33268342", "439372416", "324402933", "55031090", "309328122", "254763851", "51195863", "209213026", "74958016", "291257615", "1665778350", "1518948032", "219178151", "1148580931", "823606644", "341634643", "1307133732", "10247352", "432794829", "52991614", "300698414", "27776103", "107167985", "173528459", "1325494519", "846397470", "267802152", "1425338130", "1241708905", "218805194", "1116416330", "58898668", "1950213860", "342931490", "825906386", "182428433", "24180138", "162817516", "118698085", "1920501710", "342463163", "123002810", "16681420", "82428700", "352517611", "26121908", "397250431", "1606948220", "396665331", "408807200", "48129434", "1415995538", "48459607", "382809645", "1718472013", "293127661", "20299922", "184146579", "293048952", "461906674", "22655140", "594802359", "255677704", "318336831", "116187235", "520618969", "728283781", "743548327", "372509695", "878379420", "32941091", "1566611294", "20817934", "700992438", "20236332", "106828762", "452266132", "102076372", "481545124", "114729566", "177904476", "365340354", "1704625106", "196758914", "317832296", "53047484", "53988484", "1863906163", "89059908", "85302477", "18981792", "191552379", "68674747", "298537212", "23764940", "1583589793", "411687378", "582964189", "309832546", "255043151", "203161338", "583707286", "303074762", "22634364", "363111719", "623738760", "467603140" ]
c = Community(users_huge, "5946a5f3f810d5692244b043", "5946a5f3f810d5692244b044")


def get_statistics(com):
    # type:(Community)->tuple
    i_m = get_internal_mentions(c)
    o_m = get_out_mentions(c)
    c_m = get_common_mentions(c)
    c_h = get_common_hashtag(c)
    print c.get_profile_interests_names()
    return i_m, o_m, c_m, c_h


get_statistics(c)